#Load up a few variables from inputs, and the environment
$region = $env:CA_DPL_REGION
$tierName = $env:CA_SA_TIER_NAME
$RightScaleServerName = $env:CA_GBL_INSTANCE_NAME
$RSDeploymentName = $env:CA_DPL_DEPLOYMENT_NAME


#Set the Channel name 
if($RSDeploymentName.Contains("Elephant"))
{
    $DeployComponent = "Elephant"
}
Elseif($RSDeploymentName.Contains("Donkey"))
{
    $DeployComponent = "Donkey"
}
Elseif($RSDeploymentName.Contains("Senate"))
{
    $DeployComponent = "Senate"
}
Elseif($RSDeploymentName.Contains("House"))
{
    $DeployComponent = "House"
}
Else
{
    $DeployComponent ="Common"
}

#Get server number for last part of server name and then build out the full new name
#Stand alone servers will not have a number hence the first test
$ServerNumberArray = $RightScaleServerName -split("#")
if ($ServerNumberArray.Count -lt 2)
{
    $NewServerName = $DeployComponent + "-" + $tierName 
}
else
{
  $ServerNumber = [string]$ServerNumberArray[1]
  $NewServerName = $DeployComponent + "-" + $tierName +"-" + $ServerNumber
 }
$NewServerName = $NewServerName -replace '\s',''


$alarms = Get-CWAlarm -Region $region

[System.Collections.ArrayList]$relevantAlarms = @()

foreach ($alarm in $alarms) {
   if($alarm.AlarmName.Contains($NewServerName)){
        $relevantAlarms.Add($alarm.AlarmName)
   }
 }
Write-Output $relevantAlarms

if($relevantAlarms.Count -gt 0){
    Write-Output "Removing Alarms"
    Remove-CWAlarm -AlarmName $relevantAlarms -Force
}